# 为什么不再使用Ribbon负载均衡客户端

Spring Cloud Ribbon是基于Netflix Ribbon实现的一套*客户端*    负载均衡的工具。

简单的说，Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法和服务调用。Ribbon客户端组件提供一系列完善的配置项如连接超时，重试等。简单的说，就是在配置文件中列出Load Balancer（简称LB）后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询，随机连接等）去连接这些机器。我们很容易使用Ribbon实现自定义的负载均衡算法。

Ribbon也不再更新进入了维护模式  https://github.com/Netflix/ribbon

在很早的官方文章中就给出推荐的替代产品

https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now#spring-cloud-netflix-projects-entering-maintenance-mode

![image-20240329135313902](F:\note\image\image-20240329135313902.png)

Ribbon的替代方案：spring-cloud-loadbalancer

# SpringCloud LoadBalancer简介

LoadBalancer在SpringCloud Commons模块下https://spring.io/projects/spring-cloud-commons#learn

![image-20240329140435446](F:\note\image\image-20240329140435446.png)

## **LB负载均衡(Load Balance)是什么**

简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的HA（高可用），常见的负载均衡有软件Nginx，LVS，硬件 F5等

## **spring-cloud-starter-loadbalancer组件是什么**

Spring Cloud LoadBalancer是由SpringCloud官方提供的一个开源的、简单易用的**客户端负载均衡器**，它包含在SpringCloud-commons中用它来替换了以前的Ribbon组件。相比较于Ribbon，SpringCloud LoadBalancer不仅能够支持RestTemplate，还支持WebClient（WeClient是Spring Web Flux中提供的功能，可以实现响应式异步请求）



### 负载均衡客户端 

Nginx是服务端负载均衡，客户端所有请求都会交给nginx，然后由nginx实现转发请求，即负载均衡是由服务端实现的。

loadbalancer、Ribbon是客户端负载均衡，在调用微服务接口时候，会在注册中心上获取注册信息服务列表之后缓存到JVM本地，从而在本地实现RPC远程服务调用技术。

# SpringCloud LoadBalancer负载均衡解析

LoadBalancer 在工作时分成两步：

**第一步**，先选择Consul Server从服务端查询并拉取服务列表，知道了它有多个服务(上图3个服务)，这3个实现是完全一样的，

默认轮询调用谁都可以正常执行。类似生活中求医挂号，某个科室今日出诊的全部医生，客户端你自己选一个。

**第二步**，按照指定的负载均衡策略从server取到的服务注册列表中由客户端自己选择一个地址，所以LoadBalancer是一个**客户端的**负载均衡器。

![image-20240329141410271](F:\note\image\image-20240329141410271.png)

## LoadBalancer集成

Spring Cloud LoadBalancer可以与WebClient、RestTemplate配合使用

![image-20240329141658652](F:\note\image\image-20240329141658652.png)

在consul服务注册于发现文章中，就将WebClient配置为自动使用负载均衡器客户端，当时只是从注册中心上获取注册信息服务列表后实现了远程调用，并没有验证负载均衡功能。![image-20240329142138387](F:\note\image\image-20240329142138387.png)



## 支付服务实现负载均衡

