# Nacos简介

![image-20240403141052375](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031623571.png)

## 为什么叫Nacos

![image-20240403141224840](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031623298.png)

前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service。

Nacos官网https://nacos.io/

一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台

![image-20240403141358354](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031623314.png)

简单说Nacos就是注册中心+配置中心的组合。

替代Eureka/Consul做服务注册中心

替代（Config+Bus）/Consul做服务配置中心和动态刷新

# Nacos下载

https://nacos.io/docs/latest/quickstart/quick-start/

![image-20240403142257812](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031623788.png)

当前最新版本为2.3.1

![image-20240403142622259](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031623936.png)

点击下载

![image-20240403142844806](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031623504.png)

1.解压安装包，直接运行bin目录下的startup.cmd

![image-20240403144856870](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031622225.png)

```shell
startup.cmd -m standalone
```

![image-20240403144952086](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031622508.png)

2.访问http://localhost:8848/nacos

![image-20240403145144463](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031622669.png)

## 3.关闭服务

Ctrl+c或使用命令shutdown.cmd

![image-20240403145543061](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031622879.png)

# Nacos Discovery服务注册中心

https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-discovery#spring-cloud-alibaba-nacos-discovery

通过自动配置以及其他 Spring 编程模型的习惯用法为 Spring Boot 应用程序在服务注册与发现方面提供和 Nacos 的无缝集成。 通过一些简单的注解，您可以快速来注册一个服务，并使用经过双十一考验的 Nacos 组件来作为大规模分布式系统的服务注册中心。

## 服务注册发现: Nacos Discovery Starter

服务发现是微服务架构体系中最关键的组件之一。如果尝试着用手动的方式来给每一个客户端来配置所有服务提供者的服务列表是一件非常困难的事，而且也不利于 服务的动态扩缩容。Nacos Discovery Starter 可以帮助您将服务自动注册到 Nacos 服务端并且能够动态感知和刷新某个服务实例的服务列表。除此之外，Nacos Discovery Starter 也将服务实例自身的一些元数据信息-例如 host，port,健康检查URL，主页等-注册到 Nacos 。Nacos 的获取和启动方式可以参考 [Nacos 官网](https://nacos.io/zh-cn/docs/quick-start.html)。

#### 如何引入 Nacos Discovery Starter

如果要在您的项目中使用 Nacos 来实现服务发现，使用 group ID 为 `com.alibaba.cloud` 和 artifact ID 为 `spring-cloud-starter-alibaba-nacos-discovery` 的 starter。

```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

## 基于Nacos的服务提供者

### 新建Module

cloudalibaba-provider-payment9001

### pom

```xml
    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>



    <dependencies>
        <!--nacos-discovery-->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <!-- 引入自己定义的api通用包 -->
        <dependency>
            <groupId>com.dongguo</groupId>
            <artifactId>cloud-api-common</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
        <!--SpringBoot通用依赖模块-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        <!--hutool-->
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
        </dependency>
        <!--lombok-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <scope>provided</scope>
        </dependency>
        <!--test-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
```



### yml

```yaml
server:
  port: 9001

spring:
  application:
    name: nacos-payment-provider
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848 #配置Nacos地址
```

### 主启动

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class Payment9001Application {

    public static void main(String[] args) {
        SpringApplication.run(Payment9001Application.class, args);
    }

}
```

### 业务类

创建PayAlibabaController

```java
import com.dongguo.cloud.resp.Result;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class PayAlibabaController {
    @Value("${server.port}")
    private String serverPort;

    @GetMapping(value = "/pay/nacos/{id}")
    public Result getPayInfo(@PathVariable("id") Integer id) {
        return Result.success("nacos registry, serverPort: " + serverPort + "\t id:" + id);
    }
}
```

### 测试

1.启动nacos

2.启动cloudalibaba-provider-payment9001服务,查看服务是否注册到nacos

![image-20240403162030861](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031622183.png)

3.访问http://localhost:9001/pay/nacos/1

![image-20240403161942248](https://gitee.com/dongguo4812_admin/image/raw/master/image/202404031622989.png)

## 基于Nacos的服务消费者

### 新建Module

cloud-alibaba-consumer-nacos-order90



## 负载均衡