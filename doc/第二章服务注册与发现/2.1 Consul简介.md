```java
public static final String PAYMENT_SERVICE_URL = "http://localhost:8001";//先写死，硬编码
```

cloud-provider-payment8001微服务所在的IP地址和端囗号硬编码到cloud-consumer-order80订单微服务中，会存在非常多的问题

(1)如果订单微服务和支付微服务的IP地址或者端囗号发生了变化，则支付微服务将变得不可用，需要同步修改订单微服务中调用支付微服务的IP地址和端囗号。

(2)如果系统中提供了多个订单微服务和支付微服务，则无法实现微服务的负载均衡功能。

(3)如果系统需要支持更高的并发，需要部署更多的订单微服务和支付微服务，硬编码订单微服务则后续的维护会变得异常复杂。

所以，在微服务开发的过程中，需要引入服务治理功能，实现微服务之间的动态注册与发现，从此刻开始我们正式进入springCloud实战

# 为什么不再使用Eureka

## 1.Eureka已经停止更新

![image-20240328183455000](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403281834919.png)

## 2.注册中心独立与为服务功能解耦

按照Netflix的之前的思路，注册中心Eureka也是作为一个微服务且需要程序员自己开发部署；

实际情况，我们希望微服务和注册中心分离解耦，注册中心和业务无关的，不要混为一谈。

提供类似tomcat一样独立的组件，微服务注册上去使用即可。

## 3.SpringCloud Alibaba Nacos与 Consul 的崛起

Service discovery and configuration management，不仅可以实现服务发现还可以作为配置管理中心。



# 什么是Consul 

Consul官网：https://www.consul.io

Consul 是一套开源的分布式服务发现和配置管理系统，由 HashiCorp 公司用 Go 语言开发。

提供了微服务系统中的服务治理、配置中心、控制总线等功能。这些功能中的每一个都可以根据需要单独使用，也可以一起使用以构建全方位的服务网格，总之Consul提供了一种完整的服务网格解决方案。它具有很多优点。包括： 基于 raft 协议，比较简洁； 支持健康检查, 同时支持 HTTP 和 DNS 协议 支持跨数据中心的 WAN 集群 提供图形界面 跨平台，支持 Linux、Mac、Windows



Spring Cloud Consul 是一个用于服务发现和配置的开源工具，它基于 HashiCorp 的 Consul 实现。Spring Cloud Consul 使得 Spring Boot 微服务可以轻松集成 Consul，从而实现服务注册与发现、配置中心等功能。

https://docs.spring.io/spring-cloud-consul/docs/current/reference/html/

## Consul关键功能

![image-20240328190636206](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403282105754.png)

多数据中心-  Consul 旨在实现数据中心感知，并可以支持任意数量的区域，无需复杂的配置。

服务网格 - Consul 服务网格通过自动TLS加密和基于身份的授权，实现服务到服务的安全通信。应用程序可以在服务网格配置中使用边车代理，通过透明代理为入站和出站连接建立TLS连接。

API网关 - Consul API网关管理对Consul服务网格内服务的访问，允许用户为网格内部署的服务定义流量和授权策略。

服务发现 - Consul 使得服务能够简单地注册自己，并通过DNS或HTTP接口发现其他服务。外部服务（如SaaS提供商）也可以注册。

健康检查 - 健康检查功能使Consul能够迅速向操作人员发出集群中任何问题的警报。与服务发现的集成可以防止将流量路由到不健康的主机，并启用服务级别的断路器。

# 安装并运行Consul

Consul 下载地址：https://developer.hashicorp.com/consul/downloads

![image-20240328193628006](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403282105169.png)

下载完成后只有一个consul.exe文件

![image-20240328193756840](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403282105598.png)

## 启动Consul

`consul agent -dev` 是一个用于启动 Consul 服务的命令，其中 `consul agent` 表示启动 Consul 的代理进程，而 `-dev` 是一个开发模式的标志。

在开发模式下，Consul 会运行一个单一的节点，该节点同时充当客户端和服务器角色。它还会启用一个内置的 UI，用于查看集群的状态和配置。此外，这个模式还包含了大多数常用的功能，因此非常适合用于演示和本地开发。

但请注意，由于 `-dev` 模式不对服务进行序列化，所以它并不适用于生产环境。在生产环境中，你需要配置更复杂的 Consul 集群，并可能需要考虑多数据中心、安全、持久化等问题。

![image-20240328194430820](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403282105758.png)



通过以下地址可以访问Consul的首页：http://localhost:8500

![image-20240328194522900](F:\note\image\image-20240328194522900.png)





















